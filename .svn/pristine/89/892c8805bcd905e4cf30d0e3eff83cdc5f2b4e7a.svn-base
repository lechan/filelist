define(function(require, exports, module) {
	"use strict";
	var global = window.lestore || window.App5 || window.newxb;
	var tool = {
		/**
		 * 数据模板
		 * @param {String} tpl [html字符串，模板格式：#{id} ]
		 * @param {Object} stub [自定义方法集，返回需要进行替换的字符串]
		 * @param {Object} data [json数据]
		 * @return {String}
		 * @usage
		 *		formatTpl(tpl, stub, data)
		 * @e.g.
			var liTpl = '<li style="width:#{liWidth}px">\
							<a target="_blank" href="#{monitor}" style="width:#{liWidth}px">\
								<span class="logo" style="width:#{liWidth}px"></span>\
								<span class="txt" style="width:#{liWidth}px">#{ename}</span>\
							</a>\
						 </li>';
			var data = {
				liWidth: 73,
				name: "宝马",
				src: "http://d1.sina.com.cn/zhuyan/auto/haopin/201201/bmw.jpg",
				monitor: "http://www.sina.com.cn/",
				wbId: "1698264705",
				fullName: "宝马中国",
				mointorPrefix: "",
				gzmonitorPrefix: ""
			}
			var ename = function(){return 'BMW'};
			alert(formatTpl(liTpl, {"ename": ename}, data));
		 */
		formatTpl : function(tpl, stub, data) {
			return tpl.replace(/#\{(.+?)\}/g, function (match, key) {
				var result = '',
					replacer = stub[key];
				if (typeof replacer === 'undefined') {
					replacer = key;
				}
				if('[object Function]' === Object.prototype.toString.call(replacer)){
					result = replacer(data);
				} else {
					result = data[replacer];
				}
				return ('undefined' === typeof result ? '' : result);
			});
		},
		/**
		 * 滚动状态
		 * @return {Boolean} status[true:可以滚动，false：不能滚动]
		 * @return {Function} init[滚动状态初始化，默认可以滚动]
		 */
		scrollStatus : (function(){
			var
			status = true,
			init = function(){
				var self = this;
				document.addEventListener('touchmove', function(_e){
					if(!self.status){
						_e.preventDefault();
						_e.stopPropagation();
					}
				},false);
			};
			return {status : status,init : init}
		}()),
		/**
		 * 获取url的参数值
		 * @param {String} key [参数名]
		 */
		getURLParam : function(_key){
			var searchStr = window.location.search,
				paramStr, paramObj={}, paramArr, splitArr;
			if(!searchStr){return '';}
			paramStr = searchStr.slice(1);
			//单个参数
			if(paramStr.indexOf('&') === -1){
				splitArr = paramStr.split('=');
				paramObj[splitArr[0]] = splitArr[1];
			}
			//多个
			paramArr = paramStr.split('&');
			for(var i=0;i<paramArr.length;i+=1){
				splitArr = paramArr[i].split('=');
				paramObj[splitArr[0].toLowerCase()] = splitArr[1];
			}
			this.getURLParam = function(_key){
				_key=_key.toLowerCase();
				return paramObj[_key];
			};
			return this.getURLParam(_key);
		},
		/**
		 * cookie获取和设置
		 * cookie.get(_name)
		 * cookie.set(_name,_value,_day)
		 */
		cookie : (function(){
			var 
			domain = window.location.host,
			get = function(_name){
				var arr,reg=new RegExp("(^| )"+_name+"=([^;]*)(;|$)");
				if(arr=document.cookie.match(reg))
					return arr[2];
				else
					return "";
			},
			set = function(_name,_value,_day){
				var Days = _day || 30;
				var exp = new Date();
				exp.setTime(exp.getTime() + Days*24*60*60*1000);
				document.cookie = _name + "="+ _value + ";path=/;domain="+domain+";expires=" + exp.toGMTString();
			};
			return {
				get:get,
				set:set
			};
		}()),
		/**
		 * 动态加载js
		 * @param {String} url [接口地址]
		 * @param {Function} fn [回调函数]
		 */
		loadJS : function(_url,_callback){
			var script = document.createElement('script');
			script.type = "text/javascript";
			script.onload = function(){ if(_callback){ _callback(); } };
			script.src = _url;
			document.getElementsByTagName('head')[0].appendChild(script);	
		},
		/**
		 * 格式化日期
		 * @param {String} nS [时间戳：e.g. 1430370000000]
		 * @param {String} Ft [日期格式：默认yyyy-MM-dd hh:mm:ss]
		 * @usage
		 *		formatDate(id,deadtime,fn)
		 */
		formatDate : function(nS,Ft){
			Date.prototype.format = function(fmt){
				var o = {
					"M+" : this.getMonth()+1,                 //月份
					"d+" : this.getDate(),                    //日
					"h+" : this.getHours(),                   //小时
					"m+" : this.getMinutes(),                 //分
					"s+" : this.getSeconds(),                 //秒
					"q+" : Math.floor((this.getMonth()+3)/3), //季度
					"S"  : this.getMilliseconds()             //毫秒
				};
				if(/(y+)/.test(fmt))
					fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));
				for(var k in o)
					if(new RegExp("("+ k +")").test(fmt))
						fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));
				return fmt;
			}
			Ft=Ft || "yyyy-MM-dd hh:mm:ss";
			return new Date(parseInt(nS)).format(Ft);		 
		},
		/**
		 * 倒计时
		 * @param {String} id [倒计时容器id]
		 * @param {String} deadtime [最终日期：e.g. 2014/5/26 10:00:00]
		 * @param {Function} fn [回调函数]
		 * @usage
		 *		countdown.init(id,deadtime,fn)
		 */
		countdown : (function(){
			var
			serverTime = {
				//netUrl : "showtime.do",//服务器接口
				netUrl : "http://all.vic.sina.com.cn/201301smart_app/show_time.php",
				begin : function(id,deadtime,fn){
					if(!window.diffTime){
						tool.loadJS(this.netUrl,function(){
							window.diffTime = ServerSeconds*1000 - new Date().getTime();
							play(id,deadtime,fn);
						});
					}else{
						play(id,deadtime,fn);
					}
				}
			},
			doubleNum = function(num){ 
				num<10?num = '0'+num:num = ''+num;
				return num;
			},
			timeCalc = function(timing){
				var
				days = Math.floor(timing / (1000 * 60 * 60 * 24)),
				hours = Math.floor(timing/(1000 * 60 * 60))%24,
				minutes = Math.floor(timing/(1000 * 60))%60,
				seconds = Math.floor((timing/1000))%60,
				numString = days+"天"+doubleNum(hours)+"小时"+doubleNum(minutes)+"分"+doubleNum(seconds)+"秒";
				return numString;
			},
			play = function(id,deadtime,fn){
				//deadtime = '2013/1/18 10:00:00';
				var 
				timer = null,
				timing = 0,
				t = new Date(deadtime).getTime(),
				curTime = new Date().getTime() + parseInt(window.diffTime),
				//curTime = new Date().getTime(),
				clock_con = document.querySelector('#'+id);
				if(clock_con && t - curTime>0){
					timer = setInterval(function(){
						timing = t - curTime;
						if(timing>=0){
							clock_con.innerHTML = timeCalc(timing);
						}else{
							clearInterval(timer);
							if(fn && '[object Function]' === Object.prototype.toString.call(fn)){
								fn();
								return false;
							}
						}
						curTime = curTime + 1000;
					},1000);
				}else{
					clock_con.innerHTML = timeCalc(timing);	
					fn();
				}
			},
			init = function(id,deadtime,fn){
				serverTime.begin(id,deadtime,fn);
				//play(id,deadtime,fn);
			};
			return {init:init};
		}()),
		/**
		 * 快速点击
		 * [解决click的300ms延迟和touch的点击穿透bug]
		 * @usage
		 *		fastClick()
		 */
		fastClick : function(){
			function FastClick(layer,options){'use strict';var oldOnClick;options=options||{};this.trackingClick=false;this.trackingClickStart=0;this.targetElement=null;this.touchStartX=0;this.touchStartY=0;this.lastTouchIdentifier=0;this.touchBoundary=options.touchBoundary||10;this.layer=layer;this.tapDelay=options.tapDelay||200;if(FastClick.notNeeded(layer)){return}function bind(method,context){return function(){return method.apply(context,arguments)}}var methods=['onMouse','onClick','onTouchStart','onTouchMove','onTouchEnd','onTouchCancel'];var context=this;for(var i=0,l=methods.length;i<l;i++){context[methods[i]]=bind(context[methods[i]],context)}if(deviceIsAndroid){layer.addEventListener('mouseover',this.onMouse,true);layer.addEventListener('mousedown',this.onMouse,true);layer.addEventListener('mouseup',this.onMouse,true)}layer.addEventListener('click',this.onClick,true);layer.addEventListener('touchstart',this.onTouchStart,false);layer.addEventListener('touchmove',this.onTouchMove,false);layer.addEventListener('touchend',this.onTouchEnd,false);layer.addEventListener('touchcancel',this.onTouchCancel,false);if(!Event.prototype.stopImmediatePropagation){layer.removeEventListener=function(type,callback,capture){var rmv=Node.prototype.removeEventListener;if(type==='click'){rmv.call(layer,type,callback.hijacked||callback,capture)}else{rmv.call(layer,type,callback,capture)}};layer.addEventListener=function(type,callback,capture){var adv=Node.prototype.addEventListener;if(type==='click'){adv.call(layer,type,callback.hijacked||(callback.hijacked=function(event){if(!event.propagationStopped){callback(event)}}),capture)}else{adv.call(layer,type,callback,capture)}}}if(typeof layer.onclick==='function'){oldOnClick=layer.onclick;layer.addEventListener('click',function(event){oldOnClick(event)},false);layer.onclick=null}}var deviceIsAndroid=navigator.userAgent.indexOf('Android')>0;var deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent);var deviceIsIOS4=deviceIsIOS&&(/OS 4_\d(_\d)?/).test(navigator.userAgent);var deviceIsIOSWithBadTarget=deviceIsIOS&&(/OS ([6-9]|\d{2})_\d/).test(navigator.userAgent);var deviceIsBlackBerry10=navigator.userAgent.indexOf('BB10')>0;FastClick.prototype.needsClick=function(target){'use strict';switch(target.nodeName.toLowerCase()){case'button':case'select':case'textarea':if(target.disabled){return true}break;case'input':if((deviceIsIOS&&target.type==='file')||target.disabled){return true}break;case'label':case'video':return true}return(/\bneedsclick\b/).test(target.className)};FastClick.prototype.needsFocus=function(target){'use strict';switch(target.nodeName.toLowerCase()){case'textarea':return true;case'select':return!deviceIsAndroid;case'input':switch(target.type){case'button':case'checkbox':case'file':case'image':case'radio':case'submit':return false}return!target.disabled&&!target.readOnly;default:return(/\bneedsfocus\b/).test(target.className)}};FastClick.prototype.sendClick=function(targetElement,event){'use strict';var clickEvent,touch;if(document.activeElement&&document.activeElement!==targetElement){document.activeElement.blur()}touch=event.changedTouches[0];clickEvent=document.createEvent('MouseEvents');clickEvent.initMouseEvent(this.determineEventType(targetElement),true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);clickEvent.forwardedTouchEvent=true;targetElement.dispatchEvent(clickEvent)};FastClick.prototype.determineEventType=function(targetElement){'use strict';if(deviceIsAndroid&&targetElement.tagName.toLowerCase()==='select'){return'mousedown'}return'click'};FastClick.prototype.focus=function(targetElement){'use strict';var length;if(deviceIsIOS&&targetElement.setSelectionRange&&targetElement.type.indexOf('date')!==0&&targetElement.type!=='time'){length=targetElement.value.length;targetElement.setSelectionRange(length,length)}else{targetElement.focus()}};FastClick.prototype.updateScrollParent=function(targetElement){'use strict';var scrollParent,parentElement;scrollParent=targetElement.fastClickScrollParent;if(!scrollParent||!scrollParent.contains(targetElement)){parentElement=targetElement;do{if(parentElement.scrollHeight>parentElement.offsetHeight){scrollParent=parentElement;targetElement.fastClickScrollParent=parentElement;break}parentElement=parentElement.parentElement}while(parentElement)}if(scrollParent){scrollParent.fastClickLastScrollTop=scrollParent.scrollTop}};FastClick.prototype.getTargetElementFromEventTarget=function(eventTarget){'use strict';if(eventTarget.nodeType===Node.TEXT_NODE){return eventTarget.parentNode}return eventTarget};FastClick.prototype.onTouchStart=function(event){'use strict';var targetElement,touch,selection;if(event.targetTouches.length>1){return true}targetElement=this.getTargetElementFromEventTarget(event.target);touch=event.targetTouches[0];if(deviceIsIOS){selection=window.getSelection();if(selection.rangeCount&&!selection.isCollapsed){return true}if(!deviceIsIOS4){if(touch.identifier===this.lastTouchIdentifier){event.preventDefault();return false}this.lastTouchIdentifier=touch.identifier;this.updateScrollParent(targetElement)}}this.trackingClick=true;this.trackingClickStart=event.timeStamp;this.targetElement=targetElement;this.touchStartX=touch.pageX;this.touchStartY=touch.pageY;if((event.timeStamp-this.lastClickTime)<this.tapDelay){event.preventDefault()}return true};FastClick.prototype.touchHasMoved=function(event){'use strict';var touch=event.changedTouches[0],boundary=this.touchBoundary;if(Math.abs(touch.pageX-this.touchStartX)>boundary||Math.abs(touch.pageY-this.touchStartY)>boundary){return true}return false};FastClick.prototype.onTouchMove=function(event){'use strict';if(!this.trackingClick){return true}if(this.targetElement!==this.getTargetElementFromEventTarget(event.target)||this.touchHasMoved(event)){this.trackingClick=false;this.targetElement=null}return true};FastClick.prototype.findControl=function(labelElement){'use strict';if(labelElement.control!==undefined){return labelElement.control}if(labelElement.htmlFor){return document.getElementById(labelElement.htmlFor)}return labelElement.querySelector('button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea')};FastClick.prototype.onTouchEnd=function(event){'use strict';var forElement,trackingClickStart,targetTagName,scrollParent,touch,targetElement=this.targetElement;if(!this.trackingClick){return true}if((event.timeStamp-this.lastClickTime)<this.tapDelay){this.cancelNextClick=true;return true}this.cancelNextClick=false;this.lastClickTime=event.timeStamp;trackingClickStart=this.trackingClickStart;this.trackingClick=false;this.trackingClickStart=0;if(deviceIsIOSWithBadTarget){touch=event.changedTouches[0];targetElement=document.elementFromPoint(touch.pageX-window.pageXOffset,touch.pageY-window.pageYOffset)||targetElement;targetElement.fastClickScrollParent=this.targetElement.fastClickScrollParent}targetTagName=targetElement.tagName.toLowerCase();if(targetTagName==='label'){forElement=this.findControl(targetElement);if(forElement){this.focus(targetElement);if(deviceIsAndroid){return false}targetElement=forElement}}else if(this.needsFocus(targetElement)){if((event.timeStamp-trackingClickStart)>100||(deviceIsIOS&&window.top!==window&&targetTagName==='input')){this.targetElement=null;return false}this.focus(targetElement);this.sendClick(targetElement,event);if(!deviceIsIOS||targetTagName!=='select'){this.targetElement=null;event.preventDefault()}return false}if(deviceIsIOS&&!deviceIsIOS4){scrollParent=targetElement.fastClickScrollParent;if(scrollParent&&scrollParent.fastClickLastScrollTop!==scrollParent.scrollTop){return true}}if(!this.needsClick(targetElement)){event.preventDefault();this.sendClick(targetElement,event)}return false};FastClick.prototype.onTouchCancel=function(){'use strict';this.trackingClick=false;this.targetElement=null};FastClick.prototype.onMouse=function(event){'use strict';if(!this.targetElement){return true}if(event.forwardedTouchEvent){return true}if(!event.cancelable){return true}if(!this.needsClick(this.targetElement)||this.cancelNextClick){if(event.stopImmediatePropagation){event.stopImmediatePropagation()}else{event.propagationStopped=true}event.stopPropagation();event.preventDefault();return false}return true};FastClick.prototype.onClick=function(event){'use strict';var permitted;if(this.trackingClick){this.targetElement=null;this.trackingClick=false;return true}if(event.target.type==='submit'&&event.detail===0){return true}permitted=this.onMouse(event);if(!permitted){this.targetElement=null}return permitted};FastClick.prototype.destroy=function(){'use strict';var layer=this.layer;if(deviceIsAndroid){layer.removeEventListener('mouseover',this.onMouse,true);layer.removeEventListener('mousedown',this.onMouse,true);layer.removeEventListener('mouseup',this.onMouse,true)}layer.removeEventListener('click',this.onClick,true);layer.removeEventListener('touchstart',this.onTouchStart,false);layer.removeEventListener('touchmove',this.onTouchMove,false);layer.removeEventListener('touchend',this.onTouchEnd,false);layer.removeEventListener('touchcancel',this.onTouchCancel,false)};FastClick.notNeeded=function(layer){'use strict';var metaViewport;var chromeVersion;var blackberryVersion;if(typeof window.ontouchstart==='undefined'){return true}chromeVersion=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(chromeVersion){if(deviceIsAndroid){metaViewport=document.querySelector('meta[name=viewport]');if(metaViewport){if(metaViewport.content.indexOf('user-scalable=no')!==-1){return true}if(chromeVersion>31&&document.documentElement.scrollWidth<=window.outerWidth){return true}}}else{return true}}if(deviceIsBlackBerry10){blackberryVersion=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);if(blackberryVersion[1]>=10&&blackberryVersion[2]>=3){metaViewport=document.querySelector('meta[name=viewport]');if(metaViewport){if(metaViewport.content.indexOf('user-scalable=no')!==-1){return true}if(document.documentElement.scrollWidth<=window.outerWidth){return true}}}}if(layer.style.msTouchAction==='none'){return true}return false};FastClick.attach=function(layer,options){'use strict';return new FastClick(layer,options)};if(typeof define=='function'&&typeof define.amd=='object'&&define.amd){define(function(){'use strict';return FastClick})}else if(typeof module!=='undefined'&&module.exports){module.exports=FastClick.attach;module.exports.FastClick=FastClick}else{window.FastClick=FastClick};
			//FastClick.attach(document.body);
			document.addEventListener('DOMContentLoaded', function() {
				FastClick.attach(document.body);
			}, false);	
		}		
	};
	module.exports = tool;
});