<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="minimum-scale=1; maximum-scale=1; initial-scale=1; user-scalable=no; width=device-width;" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<title>升级才能使用</title>
<style type="text/css">
*{ margin:0px; padding:0px;}
.wrap{ width:320px; margin:0 auto; text-align:center;}
.img_wrap{ padding:75px 0px 30px;}
.img_wrap img{ vertical-align:top;}
.wrap h1{ font-size:14px; color:#6F6E6E; margin-bottom:15px;}
.wrap p{ margin-bottom:40px;}
.wrap p span{ font-size:12px; padding:5px 10px; border:1px solid #CCCCCC; color:#919191; margin:0px 5px;}
.wrap h2 a{ font-size:16px; border:2px solid #FE8800; color:#FE8800; padding:10px 25px; border-radius:20px; cursor:pointer; text-decoration:none;}
</style>
</head>

<body>



<div class="wrap">
	<div class="img_wrap"><img src="images/updateBg.png" width="220" /></div>
    <h1>您还在使用旧版本，立刻升级新版乐商店吧！</h2>
    <p>
    	<span>福利社</span>
        <span>全新的界面</span>
        <span>免流量专区</span>
    </p>
    <h2><a href="javascript:lestoreapp()">立即升级</a></h3>
</div>
<script type="text/javascript">
//最新版乐商店的app下载
function lestoreapp(){
	var global;
	if(window.lestore){
		global = window.lestore;
	}else if(window.App5){
		global = window.App5;	
	}else if(window.newxb){
		global = window.newxb;
	}
	var ajax = (function(){
		var 
		get = function(_url, _param, _headers, _callback){
		  var req, i;
			req = xhr(_callback);
			req.open('GET',_url +'?'+ _param);
			for(var i in _headers){
				req.setRequestHeader(i, _headers[i]);
			}
			req.send(null);
		},
		
		post = function(_url, _param, _headers, _callback){
			var req = xhr(_callback), i;
			req.open('POST',_url);
			for(var i in _headers){
				req.setRequestHeader(i, _headers[i]);
			}
			req.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
			req.send(encodeData(_param) || null);
		},
		
		xhr = function(_callback){
			var req = new XMLHttpRequest(),
			
				timer = window.setTimeout(function(){
					req.abort();
					//LENOVO.com.ui.toast.show('请求超时！');
					global.toast('请求超时！');
				},16000);
	
			req.addEventListener("readystatechange",function(){
				if(req.readyState == 4){
					window.clearTimeout(timer);
					if(req.status == 200){
						_callback(window.JSON.parse(req.responseText));
					}else{
						global.toast('请求异常，请稍后再试！');
						//alert(req.statusText+' : '+req.status + ' : ' + req.readyState + ' : ' + req.getResponseHeader());
						//LENOVO.com.ui.toast.show('请求异常，请稍后再试');
						
					}
				}//end if readystate
			},true);
			
			return req;
		},
		
		encodeData = function(_param){
			var params = _param.split('&'), length = params.length, i, 
			tpArray, str = '';
			for(i=0;i<length;i++){
				tpArray = params[i].split('=');
				str += tpArray[0]+'='+encodeURIComponent(tpArray[1]) + (i === length-1 ? '' : '&');
			}
			return str;
		};
		
		return {
			get:get,
			post:post
		};
	})();
	
	
	var packageName = 'com.lenovo.leos.appstore',
	versionCode = '',
	downloadurl = 'http://www.lenovomm.com/appstore/shortlink/14716755',
	appName = '乐商店',
	iconurl = 'http://img.lenovomm.com/crawler@cluster-1/ams/fileman/img/icon/2014-05-21100237-_1400680957981_8905.png';
	ajax.get('map.json','',{},function(resp){
		alert(resp[packageName]);
		if(resp[packageName]){
			versionCode	= String(resp[packageName]);
			alert(global.startDownload);
			global.startDownload(packageName,versionCode,downloadurl,appName,iconurl);
		}
	});	
}
</script>
</body>
</html>
