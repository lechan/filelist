var data = [
	{
		"lcaid":"123445",
		"item":["爱尚你","爱过咧","爱奇艺","多才艺"],
		"correct":"爱奇艺"
	},
	{
		"lcaid":"123445",
		"item":["爱尚你","爱过咧","爱奇艺","多才艺"],
		"correct":"爱奇艺"
	},
	{
		"lcaid":"123445",
		"item":["爱尚你","爱过咧","爱奇艺","多才艺"],
		"correct":"爱奇艺"
	},
]


document.addEventListener('DOMContentLoaded', function(){
	//LENOVO.com.lenovoid.init('login_box');
	//LENOVO.act.initail.init();
	LENOVO.act.share.init();
	LENOVO.act.updateStore.init();
	
	$("#countdownBtn").click(function(){
		LENOVO.com.countdown.init('countdown',function(){
			alert('时间到');	
		});
	});
	
	
});


//通过hash值锚点
LENOVO.namespace('LENOVO.act.hash');
LENOVO.act.hash = (function(){
	var
	hashcode = window.location.search;
	init = function(){
		if(hashcode){
			setTimeout(function(){
				window.location.href = "#score_anchor"
			},800);
		}
	}
	return {init:init}
})()

//初始化数据
LENOVO.namespace('LENOVO.act.initail');
LENOVO.act.initail = (function(){
	var
	everydayScore = document.querySelector("#everydayScore"),
	shareBox = document.querySelector("#shareBox"),
	hardworkingBtn,
	shareToFriendBtn,
	get = function(){
		LENOVO.com.ajax.get('index.do','t='+new Date().getTime(), {"clientid":getclientid(),"lpsust":getLpsUst()}, function(data){
			
			scoreChange(data.userScore);	
			
			
			//每天领积分
			hardworkingBtn = data.btnStatus.hardworkingBtn;
			if(!hardworkingBtn){
				everydayScore.innerHTML = '<span class="btn_red" style="background:#DADADA; color:#757575;">已打卡</a>';
			}else{
				everydayScore.innerHTML = '<span class="btn_red" onClick="getOneScore()">打卡</a>';	
			}
			
			//分享微博
			shareToFriendBtn = data.btnStatus.shareToFriendBtn;
			if(!shareToFriendBtn){
				shareBox.innerHTML = '<span class="btn_red" style="background:#DADADA; color:#757575;">已分享</a>';
			}else{
				shareBox.innerHTML = '<span class="btn_red" onClick="shareweibo()">分享</a>';	
			}
			
			//下载列表
			LENOVO.act.list.renderList(data.appList);
			LENOVO.act.list.manageList();
			
			
		});	
	},
	init = function(){
		get();
	}
	return {
		init:init
	}
})()

//分享弹窗
LENOVO.namespace('LENOVO.act.share');
LENOVO.act.share = (function(){
	var 
	shareBtn = $('#actionBtn'),
	shareDialog = $('#share'),
	updateDialog = $('#updateDialog'),
	UPDATE_TIP_3 = '亲，更新至最新版本可分享哦！',
	conf = LENOVO.conf,
	global = conf.global,
	dialog = LENOVO.com.ui.dialog,
	defaultInfo = {
		url : window.location.href,
		title : encodeURIComponent('测试title'),
		content : encodeURIComponent('测试content'),
		icon : 'http://dl.lenovomm.com/ams/fileman/img/icon/2014-06-25042623-14036847839712221.png',
		pic : 'http://img.lenovomm.com/crawler@cluster-1/editor/fileman/img/icon/1413020539455_.jpg'
	},
	
	shareInfo = {
		sina:{//分享到新浪微博 
			url : encodeURIComponent(defaultInfo.url+'#com.sina.weibo'),	
			title : defaultInfo.title+' '+defaultInfo.content,	
			appkey : 3826691734,
			pic : defaultInfo.pic
		},
		renren:{//分享到人人网
			resourceUrl: encodeURIComponent(defaultInfo.url+'#com.renren.mobile.android'),
			srcUrl : defaultInfo.url,
			title : defaultInfo.title,
			description : defaultInfo.content,
			pic : defaultInfo.pic
		},
		tqq:{//分享到腾讯微博
			url : encodeURIComponent(defaultInfo.url+'#com.tencent.WBlog'),
			title : defaultInfo.title+' '+defaultInfo.content,	
			pic : defaultInfo.pic
		},
		qzone:{//分享到QQ空间
			url : encodeURIComponent(defaultInfo.url+'#com.qzone'),
			title : defaultInfo.title,
			content : defaultInfo.content,
			pic : defaultInfo.pic
		},
		douban:{//分享到豆瓣
			url : encodeURIComponent(defaultInfo.url+'#com.douban.frodo'),
			title : defaultInfo.title,
			content : defaultInfo.content,
			pic : defaultInfo.pic
		}
	},
	
	shareUrl = {
		sina : 'http://service.weibo.com/share/share.php?url={url}&title={title}&appkey={appkey}&pic={pic}',
		renren : 'http://widget.renren.com/dialog/share?resourceUrl={resourceUrl}&srcUrl={srcUrl}&title={title}&description={description}&pic={pic}',
		tqq : 'http://share.v.t.qq.com/index.php?c=share&a=index&url={url}&title={title}&pic={pic}',
		qzone : 'http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url={url}&pics={pic}&title={title}&summary={content}',
		douban : 'http://www.douban.com/share/service?image={pic}&href={url}&name={title}&text={content}&title={title}&comment='
	},
	
	formatmodel = function(str,model){
		for(var k in model){
			var re = new RegExp("{"+k+"}","g");
			str = str.replace(re,model[k]);
		}
		return str;
	},
	
	openWindow = function(str){
		navigator.userAgent.indexOf('UCBrowser') !=-1 ? window.location.href = formatmodel(shareUrl[str],shareInfo[str]) : window.open(formatmodel(shareUrl[str],shareInfo[str]));
	},
	
	share = function(){
		if(global){
			if(typeof(global.share)!=="undefined"){
				if(parseInt(global.getVersionCode()) >= 61300 && conf.device === 'phone'){
					var 
					title = decodeURIComponent(defaultInfo.title),
					content = decodeURIComponent(defaultInfo.content),
					url = defaultInfo.url,
					icon = defaultInfo.icon,
					pic = defaultInfo.pic;
					/*
						*title 标题 （必填）
						*body  文本  （必填）
						*mimeType 暂时无用
						*streamUrl 内容链接 （必填）
						*appName  暂时无用
						*iconUrl  大图远程链接（非必填参数）
						*imageUrl  大图远程链接（非必填参数）
						void share(String title, String body, String mimeType, String streamUrl, String appName, String iconUrl, String imageUrl);
					*/
					global.share(title,content,"text/plain",url,"",icon,pic);
				}else{
					//global.share(decodeURIComponent(defaultInfo.title+' '+defaultInfo.content+' '+defaultInfo.url));
					shareDialog.find("ul").css("height","204px");
					shareDialog.find("li").hide();
					shareDialog.find("li.none").show();
					dialog.show(shareDialog);
				}
			}
		}else{
			//弹出自定义分享框
			dialog.show(shareDialog);
			
		}
	},
	init = function(){
		shareBtn.click(share);
		shareDialog.find('.cancel').click(function(){ dialog.hide(shareDialog); });
		
		shareDialog.find('a').on('click', function(){
			var type = $(this).data("type");
			dialog.hide(shareDialog);
			if(type=="update"){
				updateDialog.find('.content').html(UPDATE_TIP_3);
				dialog.show(updateDialog);
			}else{
				openWindow(type);
			}
			
		});
	};
	return {
		init:init
	}
})();

//升级乐商店
LENOVO.namespace('LENOVO.act.updateStore');
LENOVO.act.updateStore = (function(){
	init = function(){
		var 
		conf = LENOVO.conf,
		global = conf.global,
		updateDialog = $('#updateDialog'),
		dialog = LENOVO.com.ui.dialog;
		$("#updateDialog .cancel").click(function(){
			dialog.hide(updateDialog);
		});
		
		$("#updateDialog .confirm").click(function(){
			if(global){
				$.ajax({
					url:'/error/queryappvc.do',
					dataType:'text',
					data:'pn=com.lenovo.leos.appstore' + (conf.device === 'pad' ? '.pad' : ''),
					type: 'GET',
					timeout: 15000,
					success: function(vc){	
						var packageName = 'com.lenovo.leos.appstore',
						versionCode = String(vc),
						downloadurl = 'http://www.lenovomm.com/appstore/psl/com.lenovo.leos.appstore?cnum=17407',
						name = '乐商店',
						iconurl = 'http://img.lenovomm.com/crawler@cluster-1/ams/fileman/img/icon/2014-05-21100237-_1400680957981_8905.png';
						if(conf.device === 'phone'){
							global.startDownload(packageName,versionCode,downloadurl,name,iconurl);	
						}else if(conf.device === 'pad'){
							global.startDownload(packageName+'.pad', versionCode, '', name);
						}
						dialog.hide(updateDialog);
					},
					error: function(xhr, status, thrown){
						//toast(status);
					}
				});
				
			}	
		});
	};
	return {init:init}
})()
