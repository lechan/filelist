(function(WIN, U, E, T){
	var jDoc=$(document), jWin=$(WIN);

	var App={
		cmtUrl:'/comment/api/addcomment'
		,replyUrl:'/comment/api/addreview'
		,doms:{errForm:'#errForm', btnSendErr:'#btnSendErr', errBody:'#errBody', starBox:'#starBox'}
		,starBoxWth:0, rank:0, starClsPfx:'star'
		,args:null
		,init:function(){
			var doms=this.doms;
			U.initDoms(doms);
			this.starBoxWth=doms.starBox.width();
			var t=this;
			doms.btnSendErr.click(function(){t.send();});
			doms.starBox.click(function(ev){t.clickStar(ev);});

			this.args={bizCode:'VIDEO', from:'', bizIdentity:U.getURLParam('aid'), grade:this.rank}
			if(API&&API.getPackageName){
				this.args.from=(API.getPackageName().indexOf('pad') === -1 ? 'PHONE_CLIENT' : 'PAD_CLIENT');
			}
			doms.errBody.focus();
		}
		,clickStar:function(ev){
			this.setStar(Math.floor(ev.offsetX/this.starBoxWth*5)+1);
		}
		,setStar:function(ix){
			var doms=this.doms;
			if(this.rank){
				doms.starBox.removeClass(this.starClsPfx+this.rank);
			}
			this.rank=ix;
			doms.starBox.addClass(this.starClsPfx+this.rank);
		}
		,send:function(){
			var doms=this.doms, val=doms.errBody.val();
			if(val){
				var pid=U.getURLParam('pid'), url;
				var args=this.args;
				args.content=val;
				args.grade=this.rank;
				if(pid){
					url=this.replyUrl;
					args.parentId=pid;
					args.originalCommentId=U.getURLParam('oid');
				}else{
					url=this.cmtUrl;
				}
				$.getJSON(url, args, this.doms.errForm, function(){
					T.show('评论成功');
					WIN.history.back();
				});
			}else{
				//doms.btnCheck.click();
				T.show('你还没有填写内容哦。');
				doms.errBody.focus();
			}
		}
	};



	$(function(){
		App.init();
	});
})(window, LENOVO.util, LENOVO.enum, LENOVO.toast);
